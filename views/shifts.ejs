<!DOCTYPE html>
<html lang="en">
<head>
    <% include components/head %>
    <link rel='stylesheet' href='stylesheets/calendar.css'/>
    <link rel='stylesheet' href='stylesheets/fullcalendar.min.css'/>
    <script src="javascripts/moment.min.js" type="text/javascript"></script>
    <script src='javascripts/fullcalendar.js'></script>
    <!-- <script src='javascripts/fullcalendar.min.js'></script> -->
    <script src="javascripts/bootstrap-select.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="stylesheets/bootstrap-select.min.css">
    <script src="javascripts/shift_scripts.js" type="text/javascript"></script>
</head>
<body>
    <% include components/menu %>
    <div class="container-fluid bg-3 text-left">
        <ul class="nav nav-tabs" id="shiftNavTab" role="tablist">
            <li class="active"><a id="calendar-tab" data-toggle="tab" href="#calendartab" role="tab" aria-controls="calendar" aria-selected="true">Calendar</a></li>
            <!-- Make available to admin only? -->
            <li><a id="rules-tab" data-toggle="tab" href="#management" role="tab" aria-controls="rules" aria-selected="false">Shift Management</a></li>
        </ul>

        <div class="tab-content" id="tabContent">

            <!-- Calendar tab-->
            <div class="tab-pane fade in active" id="calendartab">
                <br>
                <div class="row" style="height:100%">
                    <div class="col-sm-4">
                        <h4 style="width:100%;background-color:#0c1178;color:white;margin-top:5px;padding:3px;">Institute Leaderboard</h4>
                        <table class="table-condensed" style="width:100%">
                            <thead>
                                <th>Institute</th>
                                <th>Shifts all time</th>
                                <th id="table_head_this_year"></th>
                            </thead>
                            <tbody id="aggregate_table_body"></tbody>
                        </table>
                    </div>
                    <div class="col-sm-8">
                        <ul class="cal_ul pull-right" id="calendar-legend">
                            <li class="cal_li assigned">Assigned</li> 
                            <li class="cal_li free">Free</li>
                            <li class="cal_li training">Training</li>
                        </ul>
                        <div id='calendar'></div>
                    </div>
                </div>
            </div>

            <!-- Shift Management Tab -->
            <div class="tab-pane fade" id="management" role="tabpanel" aria-labelledby="overview-tab">
                <br>
                <span>Use the following forms to add/remove shifts: </span>
                <br>
                <div class="col col-sm-12" style="border-width:1px;border-style:solid;border-color:#aaa; margin-top: 10px">
                    <h4>Add Empty Shifts</h4>
                    <hr>
                    <p>Use this form to add new shifts to the calendar for people to sign up to.</p> 
                    <form id="add_shift_form" method="POST">
                        <div class="row" style="padding-left:15px">
                            <div class="col-sm-6" style="margin-top:5px">
                                <div class="row">
                                    <div class="col-6">
                                        <strong>First Date</strong> 
                                    </div>
                                    <div class="col-6">
                                        <input name="start_date" type="date" required>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6" style="margin-top:5px">
                                <div class="row">
                                    <div class="col-6">
                                        <strong>Last Date</strong>  
                                    </div>
                                    <div class="col-6">
                                        <input name="end_date" type="date" required>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6" style="margin-top:5px">
                                <div class="row">
                                    <div class="col-6">
                                        <strong>Shift Change Day</strong>
                                    </div>
                                    <div class="col-6">
                                        <select name="shift_change_day">
                                            <option value=0>Sunday</option>
                                            <option value=1>Monday</option>
                                            <option value=2>Tuesday</option>
                                            <option value=3>Wednesday</option>
                                            <option value=4>Thursday</option>
                                            <option value=5>Friday</option>
                                            <option value=6>Saturday</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6" style="margin-top:5px">
                                <div class="row">
                                    <div class="col-6">
                                        <strong>Shift Type</strong>
                                    </div>
                                    <div class="col-6">
                                        <select name="shift_type">
                                            <option value="shifter">Shifter</option>
                                            <option value="run coordinator">Run Coordinator</option>
                                            <option value="distillation">Distillation</option>
                                            <option value="data quality">Data Quality</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6" style="margin-top:5px">
                                <div class="row">
                                    <div class="col-6">
                                        <strong title="How much is this shift work in relation to one week of 'normal' shifting">Credit Multiplier</strong>
                                    </div>
                                    <div class="col-6">
                                        <input type="number" name="credit_muiltiplier" value=1.0 required>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6" style="margin-top:5px">
                                <button class="btn btn-secondary" type="submit">Submit</button>
                            </div>
                        </div>
                    </form>
                    <br> 
                </div>
                <div class="col col-sm-12" style="border-width:1px;border-style:solid;border-color:#aaa;margin-top:10px">
                    <br>
                    <h4>Remove Empty Shifts</h4>
                    <hr>
                    <p>Use this form to remove empty shifts, for example if you mess up with the above form. 
                        No worries, this will NOT remove shifts people already signed up for. If you want to 
                        do that you have to use the calendar to mark the shift as available and then run this again.</p>
                    <form id="remove_shift_form" method="POST">
                        <div class="row" style="padding-left:15px">
                            <div class="col-xs-12 col-sm-6" style="margin-top:5px">
                                <div class="row">
                                    <div class="col-6">
                                        <strong>Remove From Date</strong>
                                    </div>
                                    <div class="col-6">
                                        <input name="start_date" type="date" required="required">
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-6" style="margin-top:5px">
                                <div class="row">
                                    <div class="col-6">
                                        <strong>Remove To Date</strong>
                                    </div>
                                    <div class="col-6">
                                        <input name="end_date" type="date" required="required">
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-6" style="margin-top:5px">
                                <div class="row">
                                    <div class="col-6">
                                        <strong>Shift Type</strong>
                                    </div>
                                    <div class="col-6">
                                        <select name="shift_type">
                                            <option value="all">All</option> 
                                            <option value="shifter">Shifter</option>
                                            <option value="run coordinator">Run Coordinator</option>
                                            <option value="distillation">Distillation</option>
                                            <option value="data quality">Data Quality</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-6 pull-right" style="margin-top:5px">
                                <button class="btn btn-secondary" type="submit">Submit</button>
                            </div>
                        </div>
                    </form>
                    <br>
                </div>
            </div>

        </div>
    </div>

    <!-- Shift Sign Up -->
    <div class="modal fade in" id="signUpModal">   
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="sign_up_title">Sign up for a shift</h4>
                </div>
                <span style="font-size:12px;margin-left:15px">
                    <strong>* required field</strong>
                </span>
                <form id="sign_up_form" method="POST">
                    <div class="modal-body" style="min-height:200px;overflow-y:auto">           
                        <br>
                        <div class="row" style="margin-top:4px">
                            <div class="col-6">
                                <strong>Shift Start:</strong>
                            </div>
                            <div class="col-6">
                                <input id="id_start_date" type="date" name="start_date" readonly>
                            </div>
                        </div>
                        <div class="row" style="margin-top:4px">
                            <div class="col-6">
                                <strong>Shift End:</strong>
                            </div>
                            <div class="col-6">
                                <input id="id_end_date" type="date" name="end_date" readonly>
                            </div>
                        </div>
                        <div class="row" style="margin-top:4px">
                            <div class="col-6">
                                <strong>Shifter:</strong>
                            </div>
                            <div class="col-6">
                                <input id="id_shifter" type="text" name="shifter" readonly value="<%= user.daq_id %>">
                            </div>
                        </div>
                        <div class="row" style="margin-top:4px">
                            <div class="col-6">
                                <strong>Institute:</strong>
                            </div>
                            <div class="col-6">
                                <input id="id_institute" type="text" name="institute" readonly value="<%= user.institute %>">
                            </div>
                        </div>
                        <div class="row" style="margin-top:4px">
                            <div class="col-6">
                                <strong>Shift Type</strong>
                            </div>
                            <div class="col-6">
                                <select class="id_shift_type"name="shift_type"></select>
                            </div>
                        </div>
                        <div class="row" style="margin-top:4px">
                            <div class="col-6">
                                <strong>Will you have access to transportation?</strong>
                            </div>
                            <div class="col-6">
                                <input id="id_has_car" type="checkbox" name=has_car onchange="EnableShiftSubmit()">
                                <span>&nbsp; (check for yes)</span>
                            </div>
                        </div>
                        <div class="row" style="margin-top:4px">
                            <div class="col-6">
                                <strong title="No guarantee this will be seen so if it's important contact the local staff directly">Comment</strong>
                            </div>
                            <div class="col-6">
                                <input id="id_special_comment" type="text" name="comment" max_length=200>
                            </div>
                        </div>
                        <div class="row" style="margin-top:4px">
                            <div class="col-12">
                                <strong>Disclaimer:</strong> 
                                <span style="font-size:10pt">By signing up you indicate the following:
                                    <ul>
                                        <li>You will be present for the shift from the operations meeting
                                             on arrival day until the operations meeting on departure day.</li> 
                                        <li>You have received the required training, including the safety
                                             course, or have organized to do so.</li> 
                                        <li>You have the required computing accounts.</li>
                                        <li>You are familiar with the detector and able to operate the DAQ/SCADA
                                             systems.</li>
                                        <li> You are able to independently analyze data.</li> 
                                        <li> You have access to transportation.</li> 
                                        <li> If you have any special considerations you have contacted the
                                             operations manager already.</li>
                                    </ul>
                                </span>
                            </div>
                            <div class="col-12">
                                <strong>I have read and agree to the disclaimer: </strong> &nbsp;
                                <input id="id_disclaimer" type="checkbox" onchange="EnableShiftSubmit()">
                            </div>
                        </div>
                        <input id="id_remove" type="hidden" value="false" name="remove">
                    </div>
                    <div class="modal-footer">
                        <a class="btn btn-danger" data-dismiss="modal" href="#" style="background-color:#ef476f">Cancel</a>
                        <button class="btn.btn-success" id="shift_submit_button" disabled="disabled" type="submit" style="background-color:#06d6a0">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Shift Tooltip -->
    <div class="ttip" id="ttip">
       <div class="row" style="width:400px;margin-left:10px">
            <button class="close" type="button" onclick="CloseTooltip()" aria-hidden="true" style="font-size:30pt">&#x00D7;&nbsp;&nbsp;</button>
            <h4 class="modal-title" id="shift_modal_title">Shift Detail</h4>
        </div>
        <hr style="margin:2px">
        <div class="row">
            <div class="col-xs-4 col-sm-3">
                <strong>Start:</strong>
            </div>
            <div class="col-xs-8 col-sm-3">
                <span id="shift_modal_start"></span>
            </div>
            <div class="col-xs-4 col-sm-3">
                <strong>End:</strong>
            </div>
            <div class="col-xs-8 col-sm-3">
                <span id="shift_modal_end"></span>
            </div>
            <div class="col-xs-4 col-sm-3">
                <strong>Institute:</strong>
            </div>
            <div class="col-xs-8 col-sm-3">
                <span id="shift_modal_institute"></span>
            </div>
            <div class="col-xs-4 col-sm-3">
                <strong>Shifter:</strong>
            </div>
            <div class="col-xs-8 col-sm-3">
                <span id="shift_modal_user"></span>
            </div>
            <div class="col-xs-4 col-sm-3">
                <strong>Available:</strong>
            </div>
            <div class="col-xs-8 col-sm-3">
                <span id="shift_modal_available"></span>
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col-12">
                <button class="btn btn-info" id="btn_sign_up">Sign Up</button>
                <span>&nbsp;</span>
                <button class="btn btn-default" id="btn_mark_available">Mark Available</button>
                <span>&nbsp;</span>
                <button class="btn btn-warning" id="btn_train" hidden>Sign up for Training</button>
            </div>
        </div>
    </div>

</body>
<script type="text/javascript">
    $(function() {

        // page is now ready, initialize the calendar...
        InitializeCalendar();
        // initialize the table
        FillAggregates("#aggregate_table_body", "#table_head_this_year", "<%= user.institute %>");

    });
</script>
</html>